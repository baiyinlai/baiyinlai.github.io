<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="personal blog, Notes, GitHub, Jekyll, baige5117, all for one, 个人博客, 个人网站, 学习笔记, Music, Picture, 励志成功, 开心一刻, 学习提升, 工具, 软件" />
    <meta name="description" content="Baige5117's personal website, mainly for recording and sharing, including blogs, sayings, music, photos and anything interesting." />
    <meta name="author" content="Baige5117" />
    <meta name="robots" content="all,index,follow" />
    <meta http-equiv="imagetoolbar" content="no" />
    <meta name="revisit-after" content="7 days" />
    <meta name="rating" content="general" />
    <meta name="distribution" content="global" />
    <title>在 Linux/Gentoo 中安装 VirtualBox 虚拟机</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    


    <!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  </head>
  <body>
    <div id="top_menu">
  <div id="t_m_center">
    <div id="title">
      <a href="/" title="Home">
	<img id="hometip" src="/images/icons/home.png" alt="home" title="Home" />
      </a>
      <p>Love life, love sports, love to learn, & love...</p>
    </div>
    <ul id="top_nav">
      
       
      <li id="t_n_li">
	<a href="/blog/index.html" title="博文"><span class="db nav_bg nav_blog"></span></a>
      </li> 
      
       
      <li id="t_n_li">
	<a href="/sayings.html" title="言语"><span class="db nav_bg nav_sayings"></span></a>
      </li> 
      
       
      <li id="t_n_li">
	<a href="/music.html" title="音乐"><span class="db nav_bg nav_music"></span></a>
      </li> 
      
       
      <li id="t_n_li">
	<a href="/pictures.html" title="图片"><span class="db nav_bg nav_pictures"></span></a>
      </li> 
      
       
      <li id="t_n_li">
	<a href="/x.html" title="X"><span class="db nav_bg nav_x"></span></a>
      </li> 
      
       
      <li id="t_n_li">
	<a href="/about.html" title="关于"><span class="db nav_bg nav_about"></span></a>
      </li> 
      
    </ul>
  </div>
</div>

    <div id="page_title">
  <img src="/images/blog.png" id="p_t_img"/>
  <h2><a href="/blog/">Blog</a></h2>
  <p>Thought,&#160; done&#160; &&#160; record.</p>
  <div id="top_icons">
    <a href="#" title="订阅到QQ邮箱" target="_blank" ><img src="/images/icons/qq-24.png" alt="订阅到QQ邮箱" title="订阅到QQ邮箱" /></a>
    <a href="#" title="订阅到iGoogle或Google Reader" target="_blank"><img src="/images/icons/rss-24.png" alt="google reader" title="订阅到iGoogle或Google Reader" /></a>
    <a href="#" title="My Github" target="_blank"><img src="/images/icons/github-24.png" alt="google reader" title="My Github" /></a>
  </div>
  <div id="google_search"><!--Google站内搜索开始-->
    <form name="cse" id="searchbox_demo" action="/search.html">
      <input type="hidden" name="cref" value="" />
      <input type="hidden" name="ie" value="utf-8" />
      <input type="hidden" name="hl" value="zh-CN" />
      <input name="q" type="text" size="20" />
      <input type="submit" name="sa" value="Search" />
    </form>
    <!--script type="text/javascript" src="http://www.google.com/cse/tools/onthefly?form=searchbox_demo&lang=zh-CN"></script-->
  </div><!--Google站内搜索结束-->
</div>

    <div id="out_wrap">
      <div id="wrap">
	<div id="post_wrapper">
  <h1 class="post_title">在 Linux/Gentoo 中安装 VirtualBox 虚拟机</h1>
  <div id="post_info">
    <ul>
      <li class="p_i_bg date">2013-08-30</li>
      <li class="p_i_bg author">Baige5117</li>
      <li class="p_i_bg cat"><a href="/blog/categories.html#工具与软件">工具与软件</a></li>
      <li class="p_i_bg tag"><a href="/blog/tags.html#Linux">Linux&nbsp;&nbsp;</a><a href="/blog/tags.html#软件">软件&nbsp;&nbsp;</a><a href="/blog/tags.html#学习笔记">学习笔记&nbsp;&nbsp;</a></li>
      
    </ul>
  </div>
  <h2>安装方法</h2>

<h3>手动编译安装</h3>

<p>到 <a href="https://www.virtualbox.org/">VirtualBox 官网</a>下载最新安装版本，linux 版本是 tar.gz 压缩包，下载之后解压缩，会得到一个 virtualbox*.run 文件，查看该文件是不是可执行文件，若不是将其添加可执行权限：</p>

<pre><code># chmod +x virtualbox*.run
</code></pre>

<p>然后安装 VirtualBox：</p>

<pre><code># ./virtualbox*.run install
</code></pre>

<p>安装完之后要将用户添加到 vboxusers 组中才可使用 VirtualBox：</p>

<pre><code>$ less /etc/group           //查看系统中都有哪些组
$ groups Jim            //查看普通用户 Jim 都属于那些组
# gpasswd -a Jim vboxusers      //将 Jim 添加到 vboxusers 组
</code></pre>

<p>之后点击 VirtualBox 图标很可能打不开，此时需要安装 media-libs/libsdl 软件包：</p>

<pre><code># emerge -avt media-libs/libsdl 
</code></pre>

<p>安装之后就能顺利打开虚拟机。</p>

<h3>Portage 安装</h3>

<p>直接在 Gentoo 的 portage 中安装，有两种版本可以选择：app-emulation/virtualbox、app-emulation/virtualbox-bin，一个是源码包，一个是编译好的二进制包。如果安装 app-emulation/virtualbox，则需要设置 USE：additions、alsa、extensions、pam、qt4 -java -vboxwebsrv （有的USE已经是默认设置）；而如果安装 app-emulation/virtualbox-bin，则其 USE 为：additions、chm、-vboxwebsrv。本人选择安装编译好的二进制包，因为比较快。需要同时安装 app-emulation/virtualbox-modules。</p>

<pre><code># emerge -avt app-emulation/virtualbox-bin
# emerge -avt app-emulation/virtualbox-modules
</code></pre>

<p>最后安装完显示以下信息：</p>

<pre><code> * To launch VirtualBox just type: "VirtualBox" 
 * You must be in the vboxusers group to use VirtualBox. 
 * For advanced networking setups you should emerge: 
 * net-misc/bridge-utils and sys-apps/usermode-utilities 
 * Please visit http://www.virtualbox.org/wiki/Editions for 
 * an overview about the different features of virtualbox-bin 
 * and virtualbox-ose 

 * Messages for package app-emulation/virtualbox-modules-4.1.8: 
 * Starting with the 3.x release new kernel modules were added, 
 * be sure to load all the needed modules. 

 * Please add "vboxdrv", "vboxnetflt" and "vboxnetadp" to: 
 * /etc/conf.d/modules 
</code></pre>

<p>按照提示，在启动虚拟机之前应该先加载 vboxdrv、vboxnetflt、vboxnetadp 模块，可以手动进行加载：</p>

<pre><code># modprobe vboxdrv
# modprobe vboxnetflt
# modprobe vboxnetadp
</code></pre>

<p>如若不想每次运行虚拟机时都手动加载这些模块，可以使计算机在启动时自动加载，方法是：在 OpenRC 系统中，将这些模块名称添加到 /etc/conf.d/modules 文件中：</p>

<pre><code># emacs /etc/conf.d/modules     //添加以下信息：
modules="vboxdrv  vboxnetflt vboxnetadp”
</code></pre>

<p>在 systemd 系统中，需要在 /etc/modules-load.d/ 目录中新建一个以 .conf 为后缀的文件，并将模块名添加进去：</p>

<pre><code># emacs /etc/modules-load.d/virtualbox.conf //添加以下信息：
  vboxdrv
  vboxnetflt
  vboxnetadp
</code></pre>

<p><strong>注意：</strong>在 portage 中也有 app-emulation/virtualbox-guest-additions 这个软件包，但是最好不要 portage 安装，因为其要依赖 x11-drivers/xf86-video-virtualbox 这个包，而这个包会与 xorg-server 发生冲突，导致再次开机后无法启动桌面。</p>

<p>安装完虚拟机之后，就拥有一台裸机了，下面就开始安装操作系统了。</p>

<h2>安装 Windows XP 操作系统</h2>

<p>选择 Windows XP 的理由是其体积小，安装完之后占用不到 10G 的空间。因此需要先从网上下载一份 XP 的光盘镜像文件。</p>

<p>在新建虚拟机之前可以先对 VirtualBox 设置一下，比如语言可以设置成中文（默认为英语），自动更新检测频率设置为一个月检测一次（默认为每天检测一次）等。具体操作为：Files > Preferences。</p>

<p>然后就是先新建一个虚拟机。单击 New，然后按照提示进行各个硬件的设置，一般选择推荐的即可，没什么难度。比如内存选择了 1G 等。</p>

<p>新建完之后接通新建虚拟机的电源，此时会提示选择启动光盘，可以直接选择 windows xp 启动镜像 iso 文件，或许刚开始会有很多提示，不用理会。其中有一个提示说系统要求 32 位，而此时系统为 16 位，要你设置 displaying，也不用理会它直接安装即可。要是没有提示选择启动光盘的页面，那么就直接启动 XP 了，但是由于还没有安装故出现 Fatal 错误，此时可以这样选择 iso 文件：Divices > CD/DVD Divices 中选择 iso 文件即可。出现选择页面，选择 windows xp 的安装。首先是格式化硬盘，格式化完之后，再次弹出选择界面，选择默认指向的选项即可，即硬盘启动计算机。之后就是启动安装了。许久之后，就安装好了，需要重启，再次出现选择页面，此时先把 iso 取下：Divices > CD/DVD Divices 中不要选择 iso 文件即可。然后选择重新启动计算机，就进入 XP 系统。</p>

<h2>安装 Guest Additions 增强功能</h2>

<p>安装完 XP 之后需要安装 VirtualBox Guest Additions，它的主要功能有：</p>

<ul>
<li>使用host机器上共享的硬盘，使用方法： mount -t vboxsf &lt;共享名> &lt;本地目录>；</li>
<li>鼠标可以自由出入vbox窗口；</li>
<li>自动与host同步时间；</li>
<li>自动根据VirtualBox窗口大小改变XP尺寸；</li>
<li>与host共享剪贴板。</li>
</ul>


<p>安装增强功能的方法是：</p>

<p>快捷键 Host（即右Ctrl键）+ Home 打开菜单，选择 Devices，单击 Install Guest Additions，或许能看到程序的安装界面。不过很多时候单击 Install Guest Additions 后并没任何反应，那么点击控制菜单设备→分配光驱→虚拟光驱，进入后你可以找到一个名为 VBoxGuestAdditions.iso 的光盘镜像文件，双击该文件，加载虚拟光驱。之后进入我的电脑，双击光盘驱动器，即可正常安装增强工具。</p>

<h2>VirtualBox 下客户端和宿主主机的文件共享设置</h2>

<p>文件共享就是在宿主机中可以访问虚拟机中的文件。</p>

<p>第一步，必须安装 Guest Additions 增强功能。</p>

<p>第二步，分配共享数据空间：</p>

<p>启动虚拟机，单击设置(setting) > Shared Folders > Add Shared Folder 图标，在合适的位置添加共享目录，例如建立 HOME/VirtualBox Vms/ShareFloder 目录，确定即可。</p>

<p>第三步，映射网络驱动器：</p>

<p>在虚拟机中打开我的电脑，进入后点击菜单工具 > 映射网络驱动器，进入后先指定驱动器号，默认即可。然后点击浏览按钮，在整个网络树状列表中找到 VirtualBox Shared Folders，该文件夹树下的地址即为数据空间中设置的主机共享文件夹。选择需要映射的目录，点击确定返回。映射完成后，再次访问我的电脑，就可以看到映射的网络驱动器了，例如 Z 盘。这样用户就能快速访问主机中的文件夹了，让 VirtualBox 打造的虚拟系统真正实现与主机的互动联通。</p>

<p><strong>注意：</strong>在日后启动 XP 后可能无法访问共享目录，此时应该在虚拟机主界面中重新添加共享目录，具体参见上述第二步。</p>

<h2>在虚拟机中添加新硬盘（比如 D 盘）</h2>

<ol>
<li>在设置 > 介质 > 添加虚拟硬盘（点击 IDE 控制器后面的硬盘图标添加新硬盘驱动）；</li>
<li>进入 guest 系统，我的 guest 系统是 xp；</li>
<li>控制面板 > 管理工具 > 计算机管理 > 存储 > 磁盘管理；</li>
<li>找到新添加的磁盘，右键新加卷初始化磁盘，并添加为扩展磁盘分区。这样就添加了一块新的硬盘，解决了磁盘空间的问题。</li>
</ol>


<h2>禁用客户机与主机的时间同步</h2>

<p>如果虚拟机中的 XP 系统的时间总是不正确，手动设置之后不久又马上回复原来，经查询原来是客户机要与宿主机进行时间同步，但是由于两者的兼容性等问题导致时间不正确，此时要禁用客户机与主机的时间同步功能，方法如下：</p>

<p>打开注册表：运行 > Regedit</p>

<p>修改以下的注册表数据：HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\VBoxService 中的 ImagePath 的值 system32\VBoxService.exe --disable-timesync，即加上参数 --disable-timesync，然后重启就可以了。</p>

<h2>虚拟机中使用USB设备</h2>

<p>启动虚拟机并插入 U 盘之后，在虚拟机菜单栏中 Devices > USB Devices，单击所要加载的 USB 设备名称即可加载。</p>

<h2>虚拟机中的快捷键</h2>

<p>VirtualBox 默认定义了右 Ctrl 键为 HOST 键，即快捷控制键。</p>

<p>实体机和虚拟机中鼠标切换：HOST。</p>

<p>全屏模式：HOST+F。</p>

<p>Scale模式：HOST+C。</p>

<p>在全屏模式和Scale模式下调出隐藏的菜单：HOST+Home。</p>

<h2>参考链接</h2>

<ul>
<li><a href="http://wiki.gentoo.org/wiki/VirtualBox">VirtualBox 官方 Gentoo Wiki</a></li>
<li><a href="https://www.virtualbox.org/">VirtualBox 官网</a></li>
<li><a href="http://www.iteye.com/topic/1113640">添加新硬盘</a></li>
</ul>


  <div id="post_nxpr">
    <ul>
      
      <li id="post_pre">
	<span class="emphasize_zh">上一篇：</span> 
	<a rel="prev" href="/blog/2013-08-21-fisherman_and_rich_man" title="渔夫与富翁的故事">渔夫与富翁的故事</a>
      </li>
      
      
      <li id="post_next">
	<span class="emphasize_zh">下一篇：</span>
	<a rel="next" href="/blog/2013-09-04-two_monk" title="两个和尚的故事">两个和尚的故事</a>
      </li>
      
    </ul>
  </div>
</div> 

      </div><!--End_wrap-->
    </div>
    <div id="footer">
<div class="bottom_nav"><a href="/">Home</a> &#160;&#124;&#160; <a href="/blog/index.html">Blog</a> &#160;&#124;&#160; <a href="/sayings.html">Sayings</a> &#160;&#124;&#160; <a href="/music.html">Music</a> &#160;&#124;&#160; <a href="/pictures.html">Pictures</a> &#160;&#124;&#160; <a href="/x.html">X</a> &#160;&#124;&#160; <a href="/about.html">About</a></div>

<div class="copyright">Copyright &#169; 2011-2013 by <a href="/index.html">Baige5117</a>. All Rights Reserved</div>
</div>
<div id="gotop">回顶部</div>
<script type="text/javascript" src="/js/gotop.js"></script>

    <!--以下为百度统计代码-->
    <script type="text/javascript">
      var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
      document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fb145740af16f12510a2d43b45804e638' type='text/javascript'%3E%3C/script%3E"));
    </script>
    
  </body>
</html>


